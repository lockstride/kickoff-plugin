# External Document Generation Workflow

Generate polished, external-facing document versions (DOCX, PPTX) from internal markdown for sharing with stakeholders.

## Required First Step

BEFORE taking any other action, you MUST use the `view` tool to read: 
`${CLAUDE_PLUGIN_ROOT}/shared-references/config-resolution.md`

## Purpose

Transform internal markdown documents into professional external formats by:
- Removing workflow-specific guidance and internal notes
- Applying consistent professional styling via reference templates
- Ensuring professional tone suitable for stakeholders
- Embedding document metadata for provenance tracking

## Prerequisites

1. **Pandoc**: Required for document generation (checked in Step 0)
2. **adm-zip**: Required for DOCX post-processing (auto-installed in Step 0)
3. **Internal document**: The source markdown must exist
4. **Configuration**: Must be set up (see `${CLAUDE_PLUGIN_ROOT}/shared-references/config-resolution.md`)

## Supported Documents

| Argument | Internal Source | External Output |
|----------|-----------------|-----------------|
| `business-brief` | business-brief.md | business-brief_v{YYMMDDHHMM}.docx |
| `market-analysis` | market-analysis.md | market-analysis_v{YYMMDDHHMM}.docx |
| `ip-search` | ip-search.md | ip-search_v{YYMMDDHHMM}.docx |
| `brand-brief` | brand-brief.md | brand-brief_v{YYMMDDHHMM}.docx |
| `product-brief` | product-brief.md | product-brief_v{YYMMDDHHMM}.docx |
| `gtm` | go-to-market-strategy.md | go-to-market-strategy_v{YYMMDDHHMM}.docx |
| `plan` | business-plan.md | business-plan_v{YYMMDDHHMM}.docx |
| `deck` | pitch-deck.md | pitch-deck_v{YYMMDDHHMM}.pptx |
| `spec` | product-spec.md | product-spec_v{YYMMDDHHMM}.docx |
| `tech` | technical-requirements.md | technical-requirements_v{YYMMDDHHMM}.docx |

**Note:** Version format is YYMMDDHHMM in GMT. All documents output as DOCX except pitch-deck which outputs as PPTX.

## Process

### Step 0: Check Prerequisites

**Check Pandoc:**
```bash
command -v pandoc
```

If Pandoc is not found, display installation guidance:

```
Pandoc is required for document generation.

Install Pandoc:
  macOS:   brew install pandoc
  Windows: Download from https://pandoc.org/installing.html
  Linux:   apt install pandoc  (or dnf install pandoc)

After installing, retry the export command.
```

**Check and install adm-zip:**

Try to load adm-zip. If the export script fails with "adm-zip is not installed", install it globally:
```bash
npm install -g adm-zip
```

This is a one-time install that makes adm-zip available system-wide.

### Step 1: Load Configuration

1. Read config to get `documentsPath` (see `${CLAUDE_PLUGIN_ROOT}/shared-references/config-resolution.md` for resolution logic)
2. Determine startup name
3. Generate slug from startup name (lowercase, hyphens)
4. Set paths:
   - `internalPath` = `{documentsPath}/generated-assets/internal`
   - `externalPath` = `{documentsPath}/generated-assets/external`

### Step 2: Validate Source Document

Check if source markdown exists. If not: "Source document not found. Generate internal document first."

### Step 3: Create External Directory

Use the Write tool to create a placeholder file in the external directory (auto-creates parent directories), or use LS to check if it exists first. This approach is cross-platform compatible.

### Step 4: Initialize Reference Template

1. Determine template type:
   - For `deck` (pitch-deck): Use `reference.pptx`
   - For all other documents: Use `reference.docx`

2. Check if template exists in external path

3. If missing, copy from skill assets:
   - Source: `assets/pandoc-templates/reference.{docx|pptx}` (skill-relative path)
   - Destination: `{externalPath}/reference.{docx|pptx}`

### Step 5: Transform Document

1. **Read source**: Load internal markdown

2. **Clean content**:
   - Remove HTML guidance comments (`<!-- Guidance: ... -->`)
   - Remove internal workflow notes
   - Remove TODO markers or draft indicators
   - Strip any footer starting with "Generated by" or "Document generated by"
   - Keep content professional and complete

3. **Generate version timestamp**: YYMMDDHHMM in GMT (e.g., `2601281430`)

4. **Restructure content**:
   - Remove the existing H1 title line
   - Add YAML front matter with metadata:
     ```markdown
     ---
     title: {Startup Name}
     subtitle: {Document Type}
     version: v{version}
     subject: {Document Type}
     keywords: {Startup Name}, {Document Type}
     ---
     
     ## Executive Summary
     ...
     ```

5. **Save intermediate file** (hidden dotfile):
   ```
   {externalPath}/.{doc}_v{version}.md
   ```

### Step 6: Run Export Script

Use the Node.js export script:

```bash
node "${CLAUDE_PLUGIN_ROOT}/skills/generating-documents/scripts/export-docx.mjs" \
  --input "{externalPath}/.{doc}_v{version}.md" \
  --output "{externalPath}/{doc}_v{version}.{docx|pptx}" \
  --reference "{externalPath}/reference.{docx|pptx}" \
  --version "v{version}"
```

### Step 7: Report Results

```
External document generated:

  Location: {externalPath}/
  File: {doc}_v{version}.{docx|pptx}
  Source: .{doc}_v{version}.md (intermediate markdown)

This document is ready for sharing with:
- Investors
- Advisors
- Team members
- Partners

To generate PDF: Open the file in Word/PowerPoint and use File > Export > PDF.

---

Template: {externalPath}/reference.{docx|pptx}

To customize document styling:
- Open the reference template in Word/PowerPoint
- Modify styles (Heading 1, Heading 2, Body Text, etc.)
- Save — future documents will use your styles

See: https://pandoc.org/MANUAL.html#option--reference-doc
```

## Quality Standards

Generated documents must embody three expert personas:

1. **Domain Expert**: Accurate terminology, industry-standard frameworks, credible data points, appropriate technical depth

2. **Serial Entrepreneur**: Practical focus, clear value propositions, realistic assumptions, investor-ready framing

3. **Master Communicator**: Compelling narrative, scannable structure, precise language, confident tone without hyperbole

**Characteristics**:
- **Succinct**: Every sentence earns its place
- **Well-organized**: Logical flow with clear hierarchy
- **Professionally formatted**: Consistent styling, appropriate whitespace
- **Compelling**: Tells a story that builds confidence
- **Convincing**: Anticipates and addresses objections

## Notes

- External documents are point-in-time snapshots with versioned filenames
- Files accumulate with timestamps — never overwritten
- Users manage old versions manually
- Regenerate after significant internal document updates
- Metadata is embedded in YAML front matter
- Reference templates can be customized per-startup
- Default template footer displays "Generated by Lockstride Kickoff"
